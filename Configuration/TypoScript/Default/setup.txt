//
// Setup for image-lightbox
//

# Add css files to page
page.includeCSS {
  tx_jhmagnificpopup10 = {$plugin.tx_jhmagnificpopup.includeMagnificpopupCss}
  tx_jhmagnificpopup10.if.isTrue = {$plugin.tx_jhmagnificpopup.includeMagnificpopupCss}
}

# Add JavaScript files to page
#page.includeJSFooterlibs {
page.includeJS {
  tx_jhmagnificpopup10 = EXT:jh_magnificpopup/Resources/Public/js/jquery-1.10.2.min.js
  tx_jhmagnificpopup10.forceOnTop = 1
  tx_jhmagnificpopup10.if.isTrue = {$plugin.tx_jhmagnificpopup.includejquerycore}

  tx_jhmagnificpopup20 = {$plugin.tx_jhmagnificpopup.includeMagnificpopupJs}
  tx_jhmagnificpopup20.if.isTrue = {$plugin.tx_jhmagnificpopup.includeMagnificpopupJs}

  tx_jhmagnificpopup25 = {$plugin.tx_jhmagnificpopup.includeIsImageFileJs}
  tx_jhmagnificpopup25.if.isTrue = {$plugin.tx_jhmagnificpopup.includeIsImageFileJs}
}

# Config tx_news if support is set
[globalVar = LIT:1 = {$plugin.tx_jhmagnificpopup.magnificpopup.support.tx_news}]
	plugin.tx_news.settings.detail.media.image {
		lightbox = magnificpopup
	}
[global]


plugin.tx_jhmagnificpopup {
	settings {
		magnificpopup {
			# Add some selectors if support is activated
			selector = COA
			selector {
				# tx_news
				10 = TEXT
				10.value = ,.mediaelement-image
				10.if.isTrue = {$plugin.tx_jhmagnificpopup.magnificpopup.support.tx_news}
				# tx_ttnews - single-view
				20 = TEXT
				20.value = ,.news-single-item
				20.if.isTrue = {$plugin.tx_jhmagnificpopup.magnificpopup.support.tx_ttnews.single}
				# tx_ttnews - list-view
				21 = TEXT
				21.value = ,.news-list-container
				21.if.isTrue = {$plugin.tx_jhmagnificpopup.magnificpopup.support.tx_ttnews.list}
				# tx_ttnews - single-view
				22 = TEXT
				22.value = ,.news-latest-container
				22.if.isTrue = {$plugin.tx_jhmagnificpopup.magnificpopup.support.tx_ttnews.latest}
				# user-defined selectors (always start with ','!)
				999 = TEXT
				999.value = ,{$plugin.tx_jhmagnificpopup.magnificpopup.support.user}
				999.insertData = 1
				999.if.isTrue = {$plugin.tx_jhmagnificpopup.magnificpopup.support.user}
			}
		}
	}
	# Copy actual page.jsFooterInline to setup to prevent from data-loss
	setup < page.jsFooterInline
	setup {
		109 = COA
		109 {
			wrap = jQuery(document).ready(function($) {|});
			10 = COA
			10 {
				#wrap = $('.csc-textpic').each(function() {|});
				10 = COA
				10 {
					wrap = $('.csc-textpic-imagewrap|').each(function() {
					10 < plugin.tx_jhmagnificpopup.settings.magnificpopup.selector
				}
				20 = COA
				20 {
					wrap = $(this).magnificPopup({|});
					10 = TEXT
					10.value = delegate: 'a:isImageFile',
					20 = TEXT
					20.value = tClose: '{LLL:EXT:jh_magnificpopup/Resources/Private/Language/locallang.xml:tClose}',
					20.insertData = 1
					30 = TEXT
					30.value = type: 'image',
					40 = TEXT
					40.value = tLoading: '{LLL:EXT:jh_magnificpopup/Resources/Private/Language/locallang.xml:tLoading}',
					40.insertData = 1
					50 = TEXT
					50.value = mainClass: 'mfp-img-mobile',
					60 = COA
					60 {
						wrap = gallery: {|},
						10 = TEXT
						10.value = enabled: {$plugin.tx_jhmagnificpopup.magnificpopup.gallery.enabled},
						20 = TEXT
						20.value = preload: [{$plugin.tx_jhmagnificpopup.magnificpopup.gallery.preload.before},{$plugin.tx_jhmagnificpopup.magnificpopup.gallery.preload.after}],
						30 = TEXT
						30.value = navigateByImgClick: {$plugin.tx_jhmagnificpopup.magnificpopup.gallery.navigateByImgClick},
						40 = TEXT
						40.value = arrowMarkup: '<button title="%title%" type="button" class="mfp-arrow mfp-arrow-%dir%"></button>',
						50 = TEXT
						50.value = tPrev: '{LLL:EXT:jh_magnificpopup/Resources/Private/Language/locallang.xml:tPrev}',
						50.insertData = 1
						60 = TEXT
						60.value = tNext: '{LLL:EXT:jh_magnificpopup/Resources/Private/Language/locallang.xml:tNext}',
						60.insertData = 1
						70 = TEXT
						70.value = tCounter: '{LLL:EXT:jh_magnificpopup/Resources/Private/Language/locallang.xml:tCounter}'
						70.insertData = 1
					}
					70 = COA
					70 {
						wrap = image: {|}
						10 = TEXT
						10.value = cursor: '{$plugin.tx_jhmagnificpopup.magnificpopup.image.cursor}',
						20 = TEXT
						20.value = titleSrc: 'title',
						30 = TEXT
						30.value = verticalGap: {$plugin.tx_jhmagnificpopup.magnificpopup.image.verticalGap},
						30 = TEXT
						30.value = verticalFit: {$plugin.tx_jhmagnificpopup.magnificpopup.image.verticalFit},
						40 = TEXT
						40.value = tError: '{LLL:EXT:jh_magnificpopup/Resources/Private/Language/locallang.xml:tError}'
						40.insertData = 1
					}
				}
				30 = TEXT
				30.value = });
			}
		}
	}
}

//add javascript to footer
page.jsFooterInline < plugin.tx_jhmagnificpopup.setup

// enable lightbox, add the right class and remove the unused rel-attriubute
styles.content.imgtext.linkWrap {
	lightboxEnabled = 1
	lightboxCssClass = magnificpopup
	lightboxRelAttribute >
}

// images in content elements
tt_content.image.20.1.imageLinkWrap {
  JSwindow = 0
  directImageLink = 1
  linkParams.ATagParams.dataWrap = class="magnificpopup"
}

// images in RTE
lib.parseFunc_RTE.tags.img.postUserFunc.imageLinkWrap {
  JSwindow = 0
  directImageLink = 1
  linkParams.ATagParams.dataWrap = class="magnificpopup"
}