//
// Setup for image-lightbox
//

# Add css files to page
page.includeCSS {
  tx_jhmagnificpopup10 = {$plugin.tx_jhmagnificpopup.includeMagnificpopupCss}
  tx_jhmagnificpopup10.if.isTrue = {$plugin.tx_jhmagnificpopup.includeMagnificpopupCss}
}

# Add JavaScript files to page
page.includeJSFooterlibs {
#page.includeJS {
  tx_jhmagnificpopup10 = EXT:jh_magnificpopup/Resources/Public/js/jquery-1.10.2.min.js
  tx_jhmagnificpopup10.forceOnTop = 1
  tx_jhmagnificpopup10.if.isTrue = {$plugin.tx_jhmagnificpopup.includejquerycore}

  tx_jhmagnificpopup20 = {$plugin.tx_jhmagnificpopup.includeMagnificpopupJs}
  tx_jhmagnificpopup20.if.isTrue = {$plugin.tx_jhmagnificpopup.includeMagnificpopupJs}

  tx_jhmagnificpopup25 = {$plugin.tx_jhmagnificpopup.includeFilterIsImageFileJs}
  tx_jhmagnificpopup25.if.isTrue = {$plugin.tx_jhmagnificpopup.includeFilterIsImageFileJs}
}

# Config tx_news if support is set
[globalVar = LIT:1 = {$plugin.tx_jhmagnificpopup.magnificpopup.support.tx_news}]
	plugin.tx_news.settings.detail.media.image {
		lightbox = magnificpopup
	}
[global]

plugin.tx_jhmagnificpopup {
	settings {
		magnificpopup {
			# Add some selectors if support is activated
			selector = COA
			selector {
				# tx_news
				10 = TEXT
				10.value = ,.news-img-wrap
				10.if.isTrue = {$plugin.tx_jhmagnificpopup.magnificpopup.support.tx_news}
				# tx_ttnews - single-view
				20 = TEXT
				20.value = ,.news-single-item
				20.if.isTrue = {$plugin.tx_jhmagnificpopup.magnificpopup.support.tx_ttnews.single}
				# tx_ttnews - list-view
				21 = TEXT
				21.value = ,.news-list-container
				21.if.isTrue = {$plugin.tx_jhmagnificpopup.magnificpopup.support.tx_ttnews.list}
				# tx_ttnews - single-view
				22 = TEXT
				22.value = ,.news-latest-container
				22.if.isTrue = {$plugin.tx_jhmagnificpopup.magnificpopup.support.tx_ttnews.latest}
				# bootstrap_package
				30 = TEXT
				30.value = ,.image-wrap
				30.if.isTrue = {$plugin.tx_jhmagnificpopup.magnificpopup.support.bootstrap_package}
				# user-defined selectors (always start with ','!)
				999 = TEXT
				999.value = ,{$plugin.tx_jhmagnificpopup.magnificpopup.support.user}
				999.insertData = 1
				999.if.isTrue = {$plugin.tx_jhmagnificpopup.magnificpopup.support.user}
			}
			templateVariables = COA
			templateVariables {
				galleryEnabled = TEXT
				galleryEnabled.value = {$plugin.tx_jhmagnificpopup.magnificpopup.gallery.enabled}
				galleryPreload = TEXT
				galleryPreload.value = [{$plugin.tx_jhmagnificpopup.magnificpopup.gallery.preload.before},{$plugin.tx_jhmagnificpopup.magnificpopup.gallery.preload.after}]
				galleryNavigateByImgClick = TEXT
				galleryNavigateByImgClick.value = {$plugin.tx_jhmagnificpopup.magnificpopup.gallery.navigateByImgClick}
				imageCursor = TEXT
				imageCursor.value = {$plugin.tx_jhmagnificpopup.magnificpopup.image.cursor}
				imageVerticalGap = TEXT
				imageVerticalGap.value = {$plugin.tx_jhmagnificpopup.magnificpopup.image.verticalGap}
				imageVerticalFit = TEXT
				imageVerticalFit.value = {$plugin.tx_jhmagnificpopup.magnificpopup.image.verticalFit}
			}
		}
	}
	# Copy actual page.jsFooterInline to setup to prevent from data-loss
	setup < page.jsFooterInline
	setup {
		# add fluidtemplate
		109 = FLUIDTEMPLATE
		109 {
			file = EXT:jh_magnificpopup/Resources/Private/Templates/TypoScript/Default.html
			variables {
				selector < plugin.tx_jhmagnificpopup.settings.magnificpopup.selector
				galleryEnabled = TEXT
				galleryEnabled.value = {$plugin.tx_jhmagnificpopup.magnificpopup.gallery.enabled}
				galleryPreload = TEXT
				galleryPreload.value = [{$plugin.tx_jhmagnificpopup.magnificpopup.gallery.preload.before},{$plugin.tx_jhmagnificpopup.magnificpopup.gallery.preload.after}]
				galleryNavigateByImgClick = TEXT
				galleryNavigateByImgClick.value = {$plugin.tx_jhmagnificpopup.magnificpopup.gallery.navigateByImgClick}
				imageCursor = TEXT
				imageCursor.value = {$plugin.tx_jhmagnificpopup.magnificpopup.image.cursor}
				imageVerticalGap = TEXT
				imageVerticalGap.value = {$plugin.tx_jhmagnificpopup.magnificpopup.image.verticalGap}
				imageVerticalFit = TEXT
				imageVerticalFit.value = {$plugin.tx_jhmagnificpopup.magnificpopup.image.verticalFit}
			}
		}
	}
}

//add javascript to footer
page.jsFooterInline < plugin.tx_jhmagnificpopup.setup

// enable lightbox, add the right class and remove the unused rel-attriubute
styles.content.imgtext.linkWrap {
	lightboxEnabled = 1
	lightboxCssClass = magnificpopup
	lightboxRelAttribute >
}

// images in content elements
tt_content.image.20.1.imageLinkWrap {
  JSwindow = 0
  directImageLink = 1
  linkParams.ATagParams.dataWrap = class="magnificpopup"
}

// images in RTE
lib.parseFunc_RTE.tags.img.postUserFunc.imageLinkWrap {
  JSwindow = 0
  directImageLink = 1
  linkParams.ATagParams.dataWrap = class="magnificpopup"
}